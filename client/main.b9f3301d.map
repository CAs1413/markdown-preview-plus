{"version":3,"sources":["util.ts","mathjax-helper.ts","update-preview.ts","main.ts"],"names":[],"mappings":"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","file":"main.b9f3301d.map","sourceRoot":"../src-client","sourcesContent":["export function handlePromise(promise: Promise<any>): void {\n  if (!promise) return\n  promise.catch((error: Error) => {\n    console.error(error)\n  })\n}\nimport { lstatSync, existsSync } from 'fs'\nexport function isFileSync(filePath: string) {\n  if (!existsSync(filePath)) return false\n  return lstatSync(filePath).isFile()\n}\n\nexport function isElement(node: Node): node is Element {\n  return node.nodeType === Node.ELEMENT_NODE\n}\n\n//\n// Determine path to a target element from a container `markdown-preview-plus-view`.\n//\n// @param {HTMLElement} element Target HTMLElement.\n// @return {(tag: <tag>, index: <index>)[]} Array of tokens representing a path\n//   to `element` from `markdown-preview-plus-view`. The root `markdown-preview-plus-view`\n//   element is the first elements in the array and the target element\n//   `element` at the highest index. Each element consists of a `tag` and\n//   `index` representing its index amongst its sibling elements of the same\n//   `tag`.\n//\nexport function getPathToElement(\n  element: HTMLElement,\n): Array<{ tag: string; index: number }> {\n  if (element.tagName.toLowerCase() === 'markdown-preview-plus-view') {\n    return [\n      {\n        tag: 'div',\n        index: 0,\n      },\n    ]\n  }\n\n  element = bubbleToContainerElement(element)\n  const tag = encodeTag(element)\n  const siblings = element.parentElement!.children\n  let siblingsCount = 0\n\n  for (const sibling of Array.from(siblings)) {\n    const siblingTag =\n      sibling.nodeType === 1 ? encodeTag(sibling as HTMLElement) : null\n    if (sibling === element) {\n      const pathToElement = getPathToElement(element.parentElement!)\n      pathToElement.push({\n        tag,\n        index: siblingsCount,\n      })\n      return pathToElement\n    } else if (siblingTag === tag) {\n      siblingsCount++\n    }\n  }\n  throw new Error('failure in getPathToElement')\n}\n\n//\n// Find the closest ancestor of an element that is not a decendant of either\n// `span.math` or `span.atom-text-editor`.\n//\n// @param {HTMLElement} element The element from which the search for a\n//   closest ancestor begins.\n// @return {HTMLElement} The closest ancestor to `element` that does not\n//   contain either `span.math` or `span.atom-text-editor`.\n//\nexport function bubbleToContainerElement(element: HTMLElement): HTMLElement {\n  let testElement = element\n  for (;;) {\n    const parent = testElement.parentElement\n    if (!parent) break\n    if (parent.classList.contains('MathJax_Display')) {\n      return parent.parentElement!\n    }\n    if (parent.classList.contains('atom-text-editor')) {\n      return parent\n    }\n    testElement = parent\n  }\n  return element\n}\n\n//\n// Encode tags for markdown-it.\n//\n// @param {HTMLElement} element Encode the tag of element.\n// @return {string} Encoded tag.\n//\nexport function encodeTag(element: HTMLElement): string {\n  if (element.classList.contains('math')) {\n    return 'math'\n  }\n  if (element.classList.contains('atom-text-editor')) {\n    return 'code'\n  } // only token.type is `fence` code blocks should ever be found in the first level of the tokens array\n  return element.tagName.toLowerCase()\n}\n","//\n// mathjax-helper\n//\n// This module will handle loading the MathJax environment and provide a wrapper\n// for calls to MathJax to process LaTeX equations.\n//\n\nimport path = require('path')\nimport CSON = require('season')\nimport fs = require('fs')\nimport { isFileSync } from './util'\n\nlet isMathJaxDisabled = false\nconst mjSrc = `${global.require.resolve(\n  'mathjax',\n)}?delayStartupUntil=configured`\nconst defaultRenderer: MathJaxRenderer = 'HTML-CSS'\n\n//\n// Process DOM elements for LaTeX equations with MathJax\n//\n// @param domElements An array of DOM elements to be processed by MathJax. See\n//   [element](https://developer.mozilla.org/en-US/docs/Web/API/element) for\n//   details on DOM elements.\n//\nexport async function mathProcessor(\n  domElement: Node,\n  renderer: MathJaxRenderer,\n) {\n  if (isMathJaxDisabled) return\n  await loadMathJax()\n  await queueTypeset(domElement, renderer)\n}\n\n//\n// Process maths in HTML fragment with MathJax\n//\n// @param html A HTML fragment string\n// @param callback A callback method that accepts a single parameter, a HTML\n//   fragment string that is the result of html processed by MathJax\n//\nexport async function processHTMLString(element: Element) {\n  if (isMathJaxDisabled) return element.innerHTML\n\n  await mathProcessor(element, 'SVG')\n\n  const msvgh = document.getElementById('MathJax_SVG_Hidden')\n  const svgGlyphs = msvgh && msvgh.parentNode!.cloneNode(true)\n  if (svgGlyphs !== null) {\n    element.insertBefore(svgGlyphs, element.firstChild)\n  }\n  return element.innerHTML\n}\n\n// For testing\nfunction disableMathJax(disable: boolean) {\n  isMathJaxDisabled = disable\n}\n\n//\n// Load MathJax environment\n//\n// @param listener method to call when the MathJax script was been\n//   loaded to the window. The method is passed no arguments.\n//\nlet mjPromise: Promise<void> | undefined\nasync function loadMathJax(): Promise<void> {\n  if (mjPromise) return mjPromise\n  mjPromise = attachMathJax()\n  return mjPromise\n}\n\nfunction unloadMathJax(): void {\n  mjPromise = undefined\n  const script = document.head.querySelector(`script[src='${mjSrc}']`)\n  if (script) script.remove()\n}\n\nexport const testing = {\n  loadMathJax,\n  disableMathJax,\n  unloadMathJax,\n}\n\n// private\n\nasync function getUserMacrosPath(): Promise<string> {\n  const home = await window.atom.home\n  const userMacrosPath: string | undefined | null = CSON.resolve(\n    path.join(home, 'markdown-preview-plus'),\n  )\n  return userMacrosPath != null\n    ? userMacrosPath\n    : path.join(home, 'markdown-preview-plus.cson')\n}\n\nfunction loadMacrosFile(filePath: string): object {\n  if (!CSON.isObjectPath(filePath)) {\n    return {}\n  }\n  return CSON.readFileSync(filePath, function(error?: Error, object?: object) {\n    if (object === undefined) {\n      object = {}\n    }\n    if (error !== undefined) {\n      console.warn(\n        `Error reading Latex Macros file '${filePath}': ${\n          error.stack !== undefined ? error.stack : error\n        }`,\n      )\n      console.error(`Failed to load Latex Macros from '${filePath}'`, {\n        detail: error.message,\n        dismissable: true,\n      })\n    }\n    return object\n  })\n}\n\nasync function loadUserMacros() {\n  const userMacrosPath = await getUserMacrosPath()\n  if (isFileSync(userMacrosPath)) {\n    return loadMacrosFile(userMacrosPath)\n  } else {\n    console.debug(\n      'Creating markdown-preview-plus.cson, this is a one-time operation.',\n    )\n    createMacrosTemplate(userMacrosPath)\n    return loadMacrosFile(userMacrosPath)\n  }\n}\n\nfunction createMacrosTemplate(filePath: string) {\n  const templatePath = path.join(__dirname, '../assets/macros-template.cson')\n  const templateFile = fs.readFileSync(templatePath, 'utf8')\n  fs.writeFileSync(filePath, templateFile)\n}\n\nfunction checkMacros(macrosObject: object) {\n  const namePattern = /^[^a-zA-Z\\d\\s]$|^[a-zA-Z]*$/ // letters, but no numerals.\n  for (const name in macrosObject) {\n    const value = macrosObject[name]\n    if (!name.match(namePattern) || !valueMatchesPattern(value)) {\n      delete macrosObject[name]\n      console.error(\n        `Failed to load LaTeX macro named '${name}'. Please see the [LaTeX guide](https://github.com/atom-community/markdown-preview-plus/blob/master/docs/math.md#macro-names)`,\n      )\n    }\n  }\n  return macrosObject\n}\n\nfunction valueMatchesPattern(value: any) {\n  // Different check based on whether value is string or array\n  if (Array.isArray(value)) {\n    const macroDefinition = value[0]\n    const numberOfArgs = value[1]\n    if (typeof numberOfArgs === 'number') {\n      return numberOfArgs % 1 === 0 && typeof macroDefinition === 'string'\n    } else {\n      return false\n    }\n  } else if (typeof value === 'string') {\n    return true\n  } else {\n    return false\n  }\n}\n\n// Configure MathJax environment. Similar to the TeX-AMS_HTML configuration with\n// a few unnecessary features stripped away\n//\nasync function configureMathJax() {\n  let userMacros = await loadUserMacros()\n  if (userMacros) {\n    userMacros = checkMacros(userMacros)\n  } else {\n    userMacros = {}\n  }\n\n  jaxConfigure(userMacros, await window.atom.numberEqns)\n\n  // Notify user MathJax has loaded\n  console.log('Loaded maths rendering engine MathJax')\n}\n\n//\n// Attach main MathJax script to the document\n//\nasync function attachMathJax(): Promise<void> {\n  console.log('Loading maths rendering engine MathJax')\n\n  // Attach MathJax script\n  await Promise.all([injectScript(mjSrc)])\n  await configureMathJax()\n}\n\nexport async function injectScript(scriptSrc: string) {\n  const script = document.createElement('script')\n  script.src = scriptSrc\n  script.type = 'text/javascript'\n  document.head.appendChild(script)\n  return new Promise<void>((resolve) => {\n    script.addEventListener('load', () => resolve())\n  })\n}\n\nfunction jaxConfigure(userMacros: object, numberEqns: boolean) {\n  MathJax.Hub.Config({\n    jax: ['input/TeX', `output/${defaultRenderer}`],\n    extensions: [],\n    TeX: {\n      extensions: [\n        'AMSmath.js',\n        'AMSsymbols.js',\n        'noErrors.js',\n        'noUndefined.js',\n      ],\n      Macros: userMacros,\n      equationNumbers: numberEqns\n        ? {\n            autoNumber: 'AMS',\n            useLabelIds: false,\n          }\n        : {},\n    },\n    'HTML-CSS': {\n      availableFonts: [],\n      webFont: 'TeX',\n    },\n    messageStyle: 'none',\n    showMathMenu: false,\n    skipStartupTypeset: true,\n  })\n  MathJax.Hub.Configured()\n}\n\nasync function queueTypeset(domElement: Node, renderer: MathJaxRenderer) {\n  const hasUnprocessedMath = Array.from(\n    document.querySelectorAll('script[type^=\"math/tex\"]'),\n  ).some((x) => !x.id)\n  if (!hasUnprocessedMath) return\n  const numberEqns = await window.atom.numberEqns\n  return new Promise<void>((resolve) => {\n    if (MathJax.InputJax.TeX) {\n      MathJax.Hub.Queue(['resetEquationNumbers', MathJax.InputJax.TeX])\n      if (numberEqns) {\n        MathJax.Hub.Queue(['PreProcess', MathJax.Hub])\n        MathJax.Hub.Queue(['Reprocess', MathJax.Hub])\n      }\n    }\n\n    MathJax.Hub.Queue(['setRenderer', MathJax.Hub, renderer])\n    MathJax.Hub.Queue(['Typeset', MathJax.Hub, domElement])\n    MathJax.Hub.Queue(['setRenderer', MathJax.Hub, defaultRenderer])\n    MathJax.Hub.Queue([resolve])\n  })\n}\n","// This file incorporates code from [markmon](https://github.com/yyjhao/markmon)\n// covered by the following terms:\n//\n// Copyright (c) 2014, Yao Yujian, http://yjyao.com\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport morph = require('morphdom')\nimport MathJaxHelper = require('./mathjax-helper')\nimport { handlePromise } from './util'\n\nexport class UpdatePreview {\n  constructor(private dom: HTMLElement) {\n    /* no-op */\n  }\n\n  public update(\n    domFragment: DocumentFragment,\n    renderLaTeX: boolean,\n    mjrenderer: MathJaxRenderer,\n  ) {\n    const newDom = domFragment.cloneNode(true) as DocumentFragment\n\n    for (const m of Array.from(newDom.querySelectorAll('span.math'))) {\n      const mscr = m.firstElementChild as HTMLScriptElement | null\n      if (!mscr || mscr.nodeName !== 'SCRIPT') continue\n      m.isSameNode = function(target: Node) {\n        if (target.nodeName !== 'SPAN') return false\n        const el = target as HTMLSpanElement\n        if (!el.classList.contains('math')) return false\n        const scr = el.querySelector('script')\n        if (!scr) return false\n        return mscr.innerHTML === scr.innerHTML\n      }\n    }\n\n    morph(this.dom, newDom, { childrenOnly: true })\n    if (renderLaTeX) {\n      handlePromise(MathJaxHelper.mathProcessor(this.dom, mjrenderer))\n    }\n  }\n}\n","import { ipcRenderer } from 'electron'\nimport { UpdatePreview } from './update-preview'\nimport { processHTMLString } from './mathjax-helper'\nimport * as util from './util'\n\nfunction mkResPromise<T>(): ResolvablePromise<T> {\n  let resFn: (value?: T | PromiseLike<T> | undefined) => void\n  const p = new Promise<T>((resolve) => (resFn = resolve)) as ResolvablePromise<\n    T\n  >\n  p.resolve = resFn!\n  return p\n}\n\nwindow.atom = {\n  home: mkResPromise(),\n  numberEqns: mkResPromise(),\n}\n\nipcRenderer.on<'set-atom-home'>('set-atom-home', (_evt, { home }) => {\n  window.atom.home.resolve(home)\n})\n\nipcRenderer.on<'set-number-eqns'>('set-number-eqns', (_evt, { numberEqns }) => {\n  window.atom.numberEqns.resolve(numberEqns)\n})\n\nipcRenderer.on<'style'>('style', (_event, { styles }) => {\n  let styleElem = document.head.querySelector('style#atom-styles')\n  if (!styleElem) {\n    styleElem = document.createElement('style')\n    styleElem.id = 'atom-styles'\n    document.head.appendChild(styleElem)\n  }\n  styleElem.innerHTML = styles.join('\\n')\n})\n\nipcRenderer.on<'update-images'>('update-images', (_event, { oldsrc, v }) => {\n  const imgs = document.querySelectorAll('img[src]') as NodeListOf<\n    HTMLImageElement\n  >\n  for (const img of Array.from(imgs)) {\n    let ovs: string | undefined\n    let ov: number | undefined\n    let src = img.getAttribute('src')!\n    const match = src.match(/^(.*)\\?v=(\\d+)$/)\n    if (match) [, src, ovs] = match\n    if (src === oldsrc) {\n      if (ovs !== undefined) ov = parseInt(ovs, 10)\n      if (v !== ov) img.src = v ? `${src}?v=${v}` : `${src}`\n    }\n  }\n})\n\nipcRenderer.on<'sync'>('sync', (_event, { pathToToken }) => {\n  let element = document.querySelector('div.update-preview')\n  if (!element) return\n\n  for (const token of pathToToken) {\n    const candidateElement: HTMLElement | null = element\n      .querySelectorAll(`:scope > ${token.tag}`)\n      .item(token.index) as HTMLElement\n    if (candidateElement) {\n      element = candidateElement\n    } else {\n      break\n    }\n  }\n\n  if (element.classList.contains('update-preview')) {\n    return\n  } // Do not jump to the top of the preview for bad syncs\n\n  if (!element.classList.contains('update-preview')) {\n    element.scrollIntoViewIfNeeded(true)\n  }\n  const maxScrollTop = document.body.scrollHeight - document.body.clientHeight\n  if (!(document.body.scrollTop >= maxScrollTop)) {\n    document.body.scrollTop -= document.body.clientHeight / 4\n  }\n\n  element.classList.add('flash')\n  setTimeout(() => element!.classList.remove('flash'), 1000)\n})\n\nipcRenderer.on<'use-github-style'>('use-github-style', (_event, { value }) => {\n  const elem = document.querySelector('markdown-preview-plus-view')\n  if (!elem) throw new Error(`Can't find MPP-view`)\n  if (value) {\n    elem.setAttribute('data-use-github-style', '')\n  } else {\n    elem.removeAttribute('data-use-github-style')\n  }\n})\n\nlet updatePreview: UpdatePreview | undefined\n\nipcRenderer.on<'update-preview'>(\n  'update-preview',\n  (_event, { html, renderLaTeX, mjrenderer }) => {\n    // div.update-preview created after constructor st UpdatePreview cannot\n    // be instanced in the constructor\n    const preview = document.querySelector('div.update-preview')\n    if (!preview) return\n    if (!updatePreview) {\n      updatePreview = new UpdatePreview(preview as HTMLElement)\n    }\n    const parser = new DOMParser()\n    const domDocument = parser.parseFromString(html, 'text/html')\n    const domFragment = document.createDocumentFragment()\n    for (const elem of Array.from(domDocument.body.childNodes)) {\n      domFragment.appendChild(elem)\n    }\n    updatePreview.update(domFragment, renderLaTeX, mjrenderer)\n    const doc = document\n    if (doc && domDocument.head.hasChildNodes) {\n      let container = doc.head.querySelector('original-elements')\n      if (!container) {\n        container = doc.createElement('original-elements')\n        doc.head.appendChild(container)\n      }\n      container.innerHTML = ''\n      for (const headElement of Array.from(domDocument.head.childNodes)) {\n        container.appendChild(headElement.cloneNode(true))\n      }\n    }\n  },\n)\n\nconst baseElement = document.createElement('base')\ndocument.head.appendChild(baseElement)\n\nipcRenderer.on<'set-base-path'>('set-base-path', (_evt, { path }) => {\n  if (path) baseElement.href = path\n  else baseElement.href = ''\n})\n\nipcRenderer.on<'error'>('error', (_evt, { msg }) => {\n  const preview = document.querySelector('div.update-preview')\n  if (!preview) return\n  const errorDiv = document.createElement('div')\n  errorDiv.innerHTML = `<h2>Previewing Markdown Failed</h2><h3>${msg}</h3>`\n  preview.appendChild(errorDiv)\n})\n\ndocument.addEventListener('mousewheel', (event) => {\n  if (event.ctrlKey) {\n    if (event.wheelDeltaY > 0) {\n      ipcRenderer.sendToHost<'zoom-in'>('zoom-in', undefined)\n    } else if (event.wheelDeltaY < 0) {\n      ipcRenderer.sendToHost<'zoom-out'>('zoom-out', undefined)\n    }\n    event.preventDefault()\n    event.stopPropagation()\n  }\n})\n\nlet lastContextMenuTarget: HTMLElement\ndocument.addEventListener('contextmenu', (e) => {\n  lastContextMenuTarget = e.target as HTMLElement\n})\n\nipcRenderer.on<'sync-source'>('sync-source', (_evt: any, { tokens }) => {\n  const element = lastContextMenuTarget\n  const pathToElement = util.getPathToElement(element)\n  pathToElement.shift() // remove markdown-preview-plus-view\n  pathToElement.shift() // remove div.update-preview\n  if (!pathToElement.length) {\n    return null\n  }\n\n  let finalToken = null\n  let level = 0\n\n  for (const token of tokens) {\n    if (token.level < level) {\n      break\n    }\n    if (token.hidden) {\n      continue\n    }\n    if (token.tag === pathToElement[0].tag && token.level === level) {\n      if (token.nesting === 1) {\n        if (pathToElement[0].index === 0) {\n          // tslint:disable-next-line:strict-type-predicates // TODO: complain on DT\n          if (token.map != null) {\n            finalToken = token\n          }\n          pathToElement.shift()\n          level++\n        } else {\n          pathToElement[0].index--\n        }\n      } else if (\n        token.nesting === 0 &&\n        ['math', 'code', 'hr'].includes(token.tag)\n      ) {\n        if (pathToElement[0].index === 0) {\n          finalToken = token\n          break\n        } else {\n          pathToElement[0].index--\n        }\n      }\n    }\n    if (pathToElement.length === 0) {\n      break\n    }\n  }\n\n  if (finalToken !== null) {\n    ipcRenderer.sendToHost<'open-source'>('open-source', {\n      initialLine: finalToken.map[0],\n    })\n    return finalToken.map[0]\n  } else {\n    return null\n  }\n})\n\nipcRenderer.on<'get-html-svg'>('get-html-svg', async () => {\n  const el = document.querySelector('markdown-preview-plus-view > div')\n  if (!el) {\n    ipcRenderer.sendToHost<'html-svg-result'>('html-svg-result', undefined)\n    return\n  }\n  const res = await processHTMLString(el)\n  ipcRenderer.sendToHost<'html-svg-result'>('html-svg-result', res)\n})\n\nwindow.onbeforeunload = function() {\n  return false\n}\n"]}