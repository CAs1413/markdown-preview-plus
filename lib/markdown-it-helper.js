"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const markdownItModule = require("markdown-it");
const twemoji = require("twemoji");
const path = require("path");
const util_1 = require("./util");
const _ = require("lodash");
let markdownIt = null;
let markdownItOptions = null;
let renderLaTeX = null;
let math = null;
let lazyHeaders = null;
let checkBoxes = null;
let emoji = null;
let inlineMathSeparators = null;
let blockMathSeparators = null;
const mathInline = (text) => `<span class='math'><script type='math/tex'>${text}</script></span>`;
const mathBlock = (text) => `<span class='math'><script type='math/tex; mode=display'>${text}</script></span>`;
const getOptions = () => ({
    html: true,
    xhtmlOut: false,
    breaks: atom.config.get('markdown-preview-plus.breakOnSingleNewline'),
    langPrefix: 'lang-',
    linkify: true,
    typographer: true,
});
function init(rL) {
    renderLaTeX = rL;
    markdownItOptions = getOptions();
    markdownIt = markdownItModule(markdownItOptions);
    if (renderLaTeX) {
        if (math == null) {
            math = require('markdown-it-math');
        }
        const inlineDelim = util_1.pairUp((inlineMathSeparators = atom.config.get('markdown-preview-plus.inlineMathSeparators')), 'inlineMathSeparators');
        const blockDelim = util_1.pairUp((blockMathSeparators = atom.config.get('markdown-preview-plus.blockMathSeparators')), 'blockMathSeparators');
        markdownIt.use(math, {
            inlineDelim,
            blockDelim,
            inlineRenderer: mathInline,
            blockRenderer: mathBlock,
        });
    }
    lazyHeaders = atom.config.get('markdown-preview-plus.useLazyHeaders');
    if (lazyHeaders) {
        markdownIt.use(require('markdown-it-lazy-headers'));
    }
    checkBoxes = atom.config.get('markdown-preview-plus.useCheckBoxes');
    if (checkBoxes) {
        markdownIt.use(require('markdown-it-task-lists'));
    }
    emoji = atom.config.get('markdown-preview-plus.useEmoji');
    if (emoji) {
        markdownIt.use(require('markdown-it-emoji'));
        markdownIt.renderer.rules.emoji = function (token, idx) {
            return twemoji.parse(token[idx].content, {
                folder: 'svg',
                ext: '.svg',
                base: path.dirname(require.resolve('twemoji')) + path.sep,
            });
        };
    }
}
const needsInit = (rL) => markdownIt === null ||
    markdownItOptions === null ||
    markdownItOptions.breaks !==
        atom.config.get('markdown-preview-plus.breakOnSingleNewline') ||
    lazyHeaders !== atom.config.get('markdown-preview-plus.useLazyHeaders') ||
    checkBoxes !== atom.config.get('markdown-preview-plus.useCheckBoxes') ||
    emoji !== atom.config.get('markdown-preview-plus.emoji') ||
    rL !== renderLaTeX ||
    !_.isEqual(inlineMathSeparators, atom.config.get('markdown-preview-plus.inlineMathSeparators')) ||
    !_.isEqual(blockMathSeparators, atom.config.get('markdown-preview-plus.blockMathSeparators'));
function render(text, rL) {
    if (needsInit(rL)) {
        init(rL);
    }
    return markdownIt.render(text);
}
exports.render = render;
function decode(url) {
    if (!markdownIt)
        throw new Error('markdownIt not initialized');
    return markdownIt.normalizeLinkText(url);
}
exports.decode = decode;
function getTokens(text, rL) {
    if (needsInit(rL)) {
        init(rL);
    }
    return markdownIt.parse(text, {});
}
exports.getTokens = getTokens;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFya2Rvd24taXQtaGVscGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL21hcmtkb3duLWl0LWhlbHBlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGdEQUFnRDtBQUNoRCxtQ0FBbUM7QUFDbkMsNkJBQTRCO0FBQzVCLGlDQUErQjtBQUMvQiw0QkFBMkI7QUFDM0IsSUFBSSxVQUFVLEdBQXVDLElBQUksQ0FBQTtBQUN6RCxJQUFJLGlCQUFpQixHQUFvQyxJQUFJLENBQUE7QUFDN0QsSUFBSSxXQUFXLEdBQW1CLElBQUksQ0FBQTtBQUN0QyxJQUFJLElBQUksR0FBUSxJQUFJLENBQUE7QUFDcEIsSUFBSSxXQUFXLEdBQVEsSUFBSSxDQUFBO0FBQzNCLElBQUksVUFBVSxHQUFRLElBQUksQ0FBQTtBQUMxQixJQUFJLEtBQUssR0FBUSxJQUFJLENBQUE7QUFDckIsSUFBSSxvQkFBb0IsR0FBUSxJQUFJLENBQUE7QUFDcEMsSUFBSSxtQkFBbUIsR0FBUSxJQUFJLENBQUE7QUFFbkMsTUFBTSxVQUFVLEdBQUcsQ0FBQyxJQUFZLEVBQUUsRUFBRSxDQUNsQyw4Q0FBOEMsSUFBSSxrQkFBa0IsQ0FBQTtBQUN0RSxNQUFNLFNBQVMsR0FBRyxDQUFDLElBQVksRUFBRSxFQUFFLENBQ2pDLDREQUE0RCxJQUFJLGtCQUFrQixDQUFBO0FBRXBGLE1BQU0sVUFBVSxHQUFHLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDeEIsSUFBSSxFQUFFLElBQUk7SUFDVixRQUFRLEVBQUUsS0FBSztJQUNmLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyw0Q0FBNEMsQ0FBQztJQUNyRSxVQUFVLEVBQUUsT0FBTztJQUNuQixPQUFPLEVBQUUsSUFBSTtJQUNiLFdBQVcsRUFBRSxJQUFJO0NBQ2xCLENBQUMsQ0FBQTtBQUVGLGNBQWMsRUFBVztJQUN2QixXQUFXLEdBQUcsRUFBRSxDQUFBO0lBRWhCLGlCQUFpQixHQUFHLFVB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LENBQUMsR0FBRyxDQUFDLDRDQUE0QyxDQUFDLENBQzlEO0lBQ0QsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUNSLG1CQUFtQixFQUNuQixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQywyQ0FBMkMsQ0FBQyxDQUM3RCxDQUFBO0FBRUgsZ0JBQXVCLElBQVksRUFBRSxFQUFXO0lBQzlDLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFBO0lBQ1YsQ0FBQztJQUNELE1BQU0sQ0FBQyxVQUFXLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQ2pDLENBQUM7QUFMRCx3QkFLQztBQUVELGdCQUF1QixHQUFXO0lBQ2hDLEVBQUUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDO1FBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyw0QkFBNEIsQ0FBQyxDQUFBO0lBQzlELE1BQU0sQ0FBQyxVQUFVLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDMUMsQ0FBQztBQUhELHdCQUdDO0FBRUQsbUJBQTBCLElBQVksRUFBRSxFQUFXO0lBQ2pELEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFBO0lBQ1YsQ0FBQztJQUNELE1BQU0sQ0FBQyxVQUFXLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQTtBQUNwQyxDQUFDO0FBTEQsOEJBS0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbWFya2Rvd25JdE1vZHVsZSA9IHJlcXVpcmUoJ21hcmtkb3duLWl0JylcbmltcG9ydCB0d2Vtb2ppID0gcmVxdWlyZSgndHdlbW9qaScpXG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnXG5pbXBvcnQgeyBwYWlyVXAgfSBmcm9tICcuL3V0aWwnXG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCdcbmxldCBtYXJrZG93bkl0OiBtYXJrZG93bkl0TW9kdWxlLk1hcmtkb3duSXQgfCBudWxsID0gbnVsbFxubGV0IG1hcmtkb3duSXRPcHRpb25zOiBtYXJrZG93bkl0TW9kdWxlLk9wdGlvbnMgfCBudWxsID0gbnVsbFxubGV0IHJlbmRlckxhVGVYOiBib29sZWFuIHwgbnVsbCA9IG51bGxcbmxldCBtYXRoOiBhbnkgPSBudWxsXG5sZXQgbGF6eUhlYWRlcnM6IGFueSA9IG51bGxcbmxldCBjaGVja0JveGVzOiBhbnkgPSBudWxsXG5sZXQgZW1vamk6IGFueSA9IG51bGxcbmxldCBpbmxpbmVNYXRoU2VwYXJhdG9yczogYW55ID0gbnVsbFxubGV0IGJsb2NrTWF0aFNlcGFyYXRvcnM6IGFueSA9IG51bGxcblxuY29uc3QgbWF0aElubGluZSA9ICh0ZXh0OiBzdHJpbmcpID0+XG4gIGA8c3BhbiBjbGFzcz0nbWF0aCc+PHNjcmlwdCB0eXBlPSdtYXRoL3RleCc+JHt0ZXh0fTwvc2NyaXB0Pjwvc3Bhbj5gXG5jb25zdCBtYXRoQmxvY2sgPSAodGV4dDogc3RyaW5nKSA9PlxuICBgPHNwYW4gY2xhc3M9J21hdGgnPjxzY3JpcHQgdHlwZT0nbWF0aC90ZXg7IG1vZGU9ZGlzcGxheSc+JHt0ZXh0fTwvc2NyaXB0Pjwvc3Bhbj5gXG5cbmNvbnN0IGdldE9wdGlvbnMgPSAoKSA9PiAoe1xuICBodG1sOiB0cnVlLFxuICB4aHRtbE91dDogZmFsc2UsXG4gIGJyZWFrczogYXRvbS5jb25maWcuZ2V0KCdtYXJrZG93bi1wcmV2aWV3LXBsdXMuYnJlYWtPblNpbmdsZU5ld2xpbmUnKSxcbiAgbGFuZ1ByZWZpeDogJ2xhbmctJyxcbiAgbGlua2lmeTogdHJ1ZSxcbiAgdHlwb2dyYXBoZXI6IHRydWUsXG59KVxuXG5mdW5jdGlvbiBpbml0KHJMOiBib29sZWFuKSB7XG4gIHJlbmRlckxhVGVYID0gckxcblxuICBtYXJrZG93bkl0T3B0aW9ucyA9IGdldE9wdGlvbnMoKVxuXG4gIG1hcmtkb3duSXQgPSBtYXJrZG93bkl0TW9kdWxlKG1hcmtkb3duSXRPcHRpb25zKVxuXG4gIGlmIChyZW5kZXJMYVRlWCkge1xuICAgIGlmIChtYXRoID09IG51bGwpIHtcbiAgICAgIG1hdGggPSByZXF1aXJlKCdtYXJrZG93bi1pdC1tYXRoJylcbiAgICB9XG4gICAgY29uc3QgaW5saW5lRGVsaW0gPSBwYWlyVXAoXG4gICAgICAoaW5saW5lTWF0aFNlcGFyYXRvcnMgPSBhdG9tLmNvbmZpZy5nZXQoXG4gICAgICAgICdtYXJrZG93bi1wcmV2aWV3LXBsdXMuaW5saW5lTWF0aFNlcGFyYXRvcnMnLFxuICAgICAgKSksXG4gICAgICAnaW5saW5lTWF0aFNlcGFyYXRvcnMnLFxuICAgIClcbiAgICBjb25zdCBibG9ja0RlbGltID0gcGFpclVwKFxuICAgICAgKGJsb2NrTWF0aFNlcGFyYXRvcnMgPSBhdG9tLmNvbmZpZy5nZXQoXG4gICAgICAgICdtYXJrZG93bi1wcmV2aWV3LXBsdXMuYmxvY2tNYXRoU2VwYXJhdG9ycycsXG4gICAgICApKSxcbiAgICAgICdibG9ja01hdGhTZXBhcmF0b3JzJyxcbiAgICApXG4gICAgbWFya2Rvd25JdC51c2UobWF0aCwge1xuICAgICAgaW5saW5lRGVsaW0sXG4gICAgICBibG9ja0RlbGltLFxuICAgICAgaW5saW5lUmVuZGVyZXI6IG1hdGhJbmxpbmUsXG4gICAgICBibG9ja1JlbmRlcmVyOiBtYXRoQmxvY2ssXG4gICAgfSlcbiAgfVxuXG4gIGxhenlIZWFkZXJzID0gYXRvbS5jb25maWcuZ2V0KCdtYXJrZG93bi1wcmV2aWV3LXBsdXMudXNlTGF6eUhlYWRlcnMnKVxuXG4gIGlmIChsYXp5SGVhZGVycykge1xuICAgIG1hcmtkb3duSXQudXNlKHJlcXVpcmUoJ21hcmtkb3duLWl0LWxhenktaGVhZGVycycpKVxuICB9XG5cbiAgY2hlY2tCb3hlcyA9IGF0b20uY29uZmlnLmdldCgnbWFya2Rvd24tcHJldmlldy1wbHVzLnVzZUNoZWNrQm94ZXMnKVxuXG4gIGlmIChjaGVja0JveGVzKSB7XG4gICAgbWFya2Rvd25JdC51c2UocmVxdWlyZSgnbWFya2Rvd24taXQtdGFzay1saXN0cycpKVxuICB9XG5cbiAgZW1vamkgPSBhdG9tLmNvbmZpZy5nZXQoJ21hcmtkb3duLXByZXZpZXctcGx1cy51c2VFbW9qaScpXG5cbiAgaWYgKGVtb2ppKSB7XG4gICAgbWFya2Rvd25JdC51c2UocmVxdWlyZSgnbWFya2Rvd24taXQtZW1vamknKSlcbiAgICBtYXJrZG93bkl0LnJlbmRlcmVyLnJ1bGVzLmVtb2ppID0gZnVuY3Rpb24odG9rZW4sIGlkeCkge1xuICAgICAgcmV0dXJuIHR3ZW1vamkucGFyc2UodG9rZW5baWR4XS5jb250ZW50LCB7XG4gICAgICAgIGZvbGRlcjogJ3N2ZycsXG4gICAgICAgIGV4dDogJy5zdmcnLFxuICAgICAgICBiYXNlOiBwYXRoLmRpcm5hbWUocmVxdWlyZS5yZXNvbHZlKCd0d2Vtb2ppJykpICsgcGF0aC5zZXAsXG4gICAgICB9KVxuICAgIH1cbiAgfVxufVxuXG5jb25zdCBuZWVkc0luaXQgPSAockw6IGJvb2xlYW4pID0+XG4gIG1hcmtkb3duSXQgPT09IG51bGwgfHxcbiAgbWFya2Rvd25JdE9wdGlvbnMgPT09IG51bGwgfHxcbiAgbWFya2Rvd25JdE9wdGlvbnMuYnJlYWtzICE9PVxuICAgIGF0b20uY29uZmlnLmdldCgnbWFya2Rvd24tcHJldmlldy1wbHVzLmJyZWFrT25TaW5nbGVOZXdsaW5lJykgfHxcbiAgbGF6eUhlYWRlcnMgIT09IGF0b20uY29uZmlnLmdldCgnbWFya2Rvd24tcHJldmlldy1wbHVzLnVzZUxhenlIZWFkZXJzJykgfHxcbiAgY2hlY2tCb3hlcyAhPT0gYXRvbS5jb25maWcuZ2V0KCdtYXJrZG93bi1wcmV2aWV3LXBsdXMudXNlQ2hlY2tCb3hlcycpIHx8XG4gIGVtb2ppICE9PSBhdG9tLmNvbmZpZy5nZXQoJ21hcmtkb3duLXByZXZpZXctcGx1cy5lbW9qaScpIHx8XG4gIHJMICE9PSByZW5kZXJMYVRlWCB8fFxuICAhXy5pc0VxdWFsKFxuICAgIGlubGluZU1hdGhTZXBhcmF0b3JzLFxuICAgIGF0b20uY29uZmlnLmdldCgnbWFya2Rvd24tcHJldmlldy1wbHVzLmlubGluZU1hdGhTZXBhcmF0b3JzJyksXG4gICkgfHxcbiAgIV8uaXNFcXVhbChcbiAgICBibG9ja01hdGhTZXBhcmF0b3JzLFxuICAgIGF0b20uY29uZmlnLmdldCgnbWFya2Rvd24tcHJldmlldy1wbHVzLmJsb2NrTWF0aFNlcGFyYXRvcnMnKSxcbiAgKVxuXG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyKHRleHQ6IHN0cmluZywgckw6IGJvb2xlYW4pIHtcbiAgaWYgKG5lZWRzSW5pdChyTCkpIHtcbiAgICBpbml0KHJMKVxuICB9XG4gIHJldHVybiBtYXJrZG93bkl0IS5yZW5kZXIodGV4dClcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlY29kZSh1cmw6IHN0cmluZykge1xuICBpZiAoIW1hcmtkb3duSXQpIHRocm93IG5ldyBFcnJvcignbWFya2Rvd25JdCBub3QgaW5pdGlhbGl6ZWQnKVxuICByZXR1cm4gbWFya2Rvd25JdC5ub3JtYWxpemVMaW5rVGV4dCh1cmwpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRUb2tlbnModGV4dDogc3RyaW5nLCByTDogYm9vbGVhbikge1xuICBpZiAobmVlZHNJbml0KHJMKSkge1xuICAgIGluaXQockwpXG4gIH1cbiAgcmV0dXJuIG1hcmtkb3duSXQhLnBhcnNlKHRleHQsIHt9KVxufVxuIl19