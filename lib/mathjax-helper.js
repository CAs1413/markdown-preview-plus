"use strict";
const { $ } = require('atom-space-pen-views');
const path = require('path');
const CSON = require('season');
const fs = require('fs-plus');
const _ = require('lodash');
const namePattern = new RegExp(`\
^[^a-zA-Z\\d\\s]$\
|\
^[a-zA-Z]*$\
`);
const getUserMacrosPath = function () {
    const userMacrosPath = CSON.resolve(path.join(atom.getConfigDirPath(), 'markdown-preview-plus'));
    return userMacrosPath != null ? userMacrosPath : path.join(atom.getConfigDirPath(), 'markdown-preview-plus.cson');
};
const loadMacrosFile = function (filePath) {
    if (!CSON.isObjectPath(filePath)) {
        return {};
    }
    return CSON.readFileSync(filePath, function (error, object) {
        if (object == null) {
            object = {};
        }
        if (error != null) {
            console.warn(`Error reading Latex Macros file '${filePath}': ${error.stack != null ? error.stack : error}`);
            if (atom.notifications != null) {
                atom.notifications.addError(`Failed to load Latex Macros from '${filePath}'`, { detail: error.message, dismissable: true });
            }
        }
        return object;
    });
};
const loadUserMacros = function () {
    let result;
    const userMacrosPath = getUserMacrosPath();
    if (fs.isFileSync(userMacrosPath)) {
        return result = loadMacrosFile(userMacrosPath);
    }
    else {
        console.log("Creating markdown-preview-plus.cson, this is a one-time operation.");
        createMacrosTemplate(userMacrosPath);
        return result = loadMacrosFile(userMacrosPath);
    }
};
var createMacrosTemplate = function (filePath) {
    const templatePath = path.join(__dirname, "../assets/macros-template.cson");
    const templateFile = fs.readFileSync(templatePath, 'utf8');
    return fs.writeFileSync(filePath, templateFile);
};
const checkMacros = function (macrosObject) {
    for (let name in macrosObject) {
        const value = macrosObject[name];
        if (!name.match(namePattern) || !valueMatchesPattern(value)) {
            delete macrosObject[name];
            if (atom.notifications != null) {
                atom.notifications.addError(`Failed to load LaTeX macro named '${name}'. Please see the [LaTeX guide](https://github.com/Galadirith/markdown-preview-plus/blob/master/LATEX.md#macro-names)`, { dismissable: true });
            }
        }
    }
    return macrosObject;
};
var valueMatchesPattern = function (value) {
    switch (false) {
        case Object.prototype.toString.call(value) !== '[object Array]':
            var macroDefinition = value[0];
            var numberOfArgs = value[1];
            if (typeof numberOfArgs === 'number') {
                return ((numberOfArgs % 1) === 0) && (typeof macroDefinition === 'string');
            }
            else {
                return false;
            }
        case typeof value !== 'string':
            return true;
        default: return false;
    }
};
const configureMathJax = function () {
    let userMacros = loadUserMacros();
    if (userMacros) {
        userMacros = checkMacros(userMacros);
    }
    else {
        userMacros = {};
    }
    MathJax.Hub.Config({
        jax: [
            "input/TeX",
            "output/HTML-CSS"
        ],
        extensions: [],
        TeX: {
            extensions: [
                "AMSmath.js",
                "AMSsymbols.js",
                "noErrors.js",
                "noUndefined.js"
            ],
            Macros: userMacros
        },
        "HTML-CSS": {
            availableFonts: [],
            webFont: "TeX"
        },
        messageStyle: "none",
        showMathMenu: false,
        skipStartupTypeset: true
    });
    MathJax.Hub.Configured();
    if (atom.inDevMode()) {
        atom.notifications.addSuccess("Loaded maths rendering engine MathJax");
    }
};
var attachMathJax = function () {
    if (atom.inDevMode()) {
        atom.notifications.addInfo("Loading maths rendering engine MathJax");
    }
    const script = document.createElement("script");
    script.src = `${require.resolve('MathJax')}?delayStartupUntil=configured`;
    script.type = "text/javascript";
    script.addEventListener("load", () => configureMathJax());
    document.getElementsByTagName("head")[0].appendChild(script);
    return script;
};
function __guard__(value, transform) {
    return (typeof value !== 'undefined' && value !== null) ? transform(value) : undefined;
}
module.exports = {
    loadMathJax(listener) {
        const script = this.attachMathJax();
        if (listener != null) {
            script.addEventListener("load", () => listener());
        }
    },
    attachMathJax: _.once(() => attachMathJax()),
    resetMathJax() {
        $('script[src*="MathJax.js"]').remove();
        window.MathJax = undefined;
        return this.attachMathJax = _.once(() => attachMathJax());
    },
    mathProcessor(domElements) {
        if (typeof MathJax !== 'undefined' && MathJax !== null) {
            MathJax.Hub.Queue(["Typeset", MathJax.Hub, domElements]);
        }
        else {
            this.loadMathJax(() => MathJax.Hub.Queue(["Typeset", MathJax.Hub, domElements]));
        }
    },
    processHTMLString(html, callback) {
        const element = document.createElement('div');
        element.innerHTML = html;
        const compileProcessedHTMLString = function () {
            const svgGlyphs = __guard__(document.getElementById('MathJax_SVG_Hidden'), x => x.parentNode.cloneNode(true));
            if (svgGlyphs != null) {
                element.insertBefore(svgGlyphs, element.firstChild);
            }
            return element.innerHTML;
        };
        const queueProcessHTMLString = () => MathJax.Hub.Queue(["setRenderer", MathJax.Hub, "SVG"], ["Typeset", MathJax.Hub, element], ["setRenderer", MathJax.Hub, "HTML-CSS"], [() => callback(compileProcessedHTMLString())]);
        if (typeof MathJax !== 'undefined' && MathJax !== null) {
            queueProcessHTMLString();
        }
        else {
            this.loadMathJax(queueProcessHTMLString);
        }
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWF0aGpheC1oZWxwZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvbWF0aGpheC1oZWxwZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQWNBLE1BQU0sRUFBQyxDQUFDLEVBQUMsR0FBTyxPQUFPLENBQUMsc0JBQXNCLENBQUMsQ0FBQztBQUNoRCxNQUFNLElBQUksR0FBTSxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDaEMsTUFBTSxJQUFJLEdBQU0sT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ2xDLE1BQU0sRUFBRSxHQUFRLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUNuQyxNQUFNLENBQUMsR0FBUyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFpRmxDLE1BQU0sV0FBVyxHQUFHLElBQUksTUFBTSxDQUFDOzs7O0NBSTlCLENBQUMsQ0FBQztBQUVILE1BQU0saUJBQWlCLEdBQUc7SUFDeEIsTUFBTSxjQUFjLEdBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxFQUFFLHVCQUF1QixDQUFDLENBQUMsQ0FBQztJQUNsRyxNQUFNLENBQUMsY0FBYyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxFQUFFLDRCQUE0QixDQUFDLENBQUM7QUFDcEgsQ0FBQyxDQUFDO0FBRUYsTUFBTSxjQUFjLEdBQUcsVUFBUyxRQUFRO0lBQ3RDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFBQyxNQUFNLENBQUMsRUFBRSxDQUFDO0lBQUMsQ0FBQztJQUNoRCxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsVUFBUyxLQUFLLEVBQUUsTUFBTTtRQUN2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O0lBRXRELENBQUM7Q0FDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIGRlY2FmZmVpbmF0ZSBzdWdnZXN0aW9uczpcbiAqIERTMTAyOiBSZW1vdmUgdW5uZWNlc3NhcnkgY29kZSBjcmVhdGVkIGJlY2F1c2Ugb2YgaW1wbGljaXQgcmV0dXJuc1xuICogRFMxMDM6IFJld3JpdGUgY29kZSB0byBubyBsb25nZXIgdXNlIF9fZ3VhcmRfX1xuICogRFMyMDc6IENvbnNpZGVyIHNob3J0ZXIgdmFyaWF0aW9ucyBvZiBudWxsIGNoZWNrc1xuICogRnVsbCBkb2NzOiBodHRwczovL2dpdGh1Yi5jb20vZGVjYWZmZWluYXRlL2RlY2FmZmVpbmF0ZS9ibG9iL21hc3Rlci9kb2NzL3N1Z2dlc3Rpb25zLm1kXG4gKi9cbi8vXG4vLyBtYXRoamF4LWhlbHBlclxuLy9cbi8vIFRoaXMgbW9kdWxlIHdpbGwgaGFuZGxlIGxvYWRpbmcgdGhlIE1hdGhKYXggZW52aXJvbm1lbnQgYW5kIHByb3ZpZGUgYSB3cmFwcGVyXG4vLyBmb3IgY2FsbHMgdG8gTWF0aEpheCB0byBwcm9jZXNzIExhVGVYIGVxdWF0aW9ucy5cbi8vXG5cbmNvbnN0IHskfSAgICAgPSByZXF1aXJlKCdhdG9tLXNwYWNlLXBlbi12aWV3cycpO1xuY29uc3QgcGF0aCAgICA9IHJlcXVpcmUoJ3BhdGgnKTtcbmNvbnN0IENTT04gICAgPSByZXF1aXJlKCdzZWFzb24nKTtcbmNvbnN0IGZzICAgICAgPSByZXF1aXJlKCdmcy1wbHVzJyk7XG5jb25zdCBfICAgICAgID0gcmVxdWlyZSgnbG9kYXNoJyk7XG5cbmV4cG9ydCA9IHtcbiAgLy9cbiAgLy8gTG9hZCBNYXRoSmF4IGVudmlyb25tZW50XG4gIC8vXG4gIC8vIEBwYXJhbSBsaXN0ZW5lciBPcHRpb25hbCBtZXRob2QgdG8gY2FsbCB3aGVuIHRoZSBNYXRoSmF4IHNjcmlwdCB3YXMgYmVlblxuICAvLyAgIGxvYWRlZCB0byB0aGUgd2luZG93LiBUaGUgbWV0aG9kIGlzIHBhc3NlZCBubyBhcmd1bWVudHMuXG4gIC8vXG4gIGxvYWRNYXRoSmF4KGxpc3RlbmVyKSB7XG4gICAgY29uc3Qgc2NyaXB0ID0gdGhpcy5hdHRhY2hNYXRoSmF4KCk7XG4gICAgaWYgKGxpc3RlbmVyICE9IG51bGwpIHsgc2NyaXB0LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IGxpc3RlbmVyKCkpOyB9XG4gIH0sXG5cbiAgLy9cbiAgLy8gQXR0YWNoIG1haW4gTWF0aEpheCBzY3JpcHQgdG8gdGhlIGRvY3VtZW50XG4gIC8vXG4gIGF0dGFjaE1hdGhKYXg6IF8ub25jZSgoKSA9PiBhdHRhY2hNYXRoSmF4KCkpLFxuXG4gIC8vXG4gIC8vIFJlbW92ZSBNYXRoSmF4IGZyb20gdGhlIGRvY3VtZW50IGFuZCByZXNldCBhdHRhY2ggbWV0aG9kXG4gIC8vXG4gIHJlc2V0TWF0aEpheCgpIHtcbiAgICAvLyBEZXRhY2ggTWF0aEpheCBmcm9tIHRoZSBkb2N1bWVudFxuICAgICQoJ3NjcmlwdFtzcmMqPVwiTWF0aEpheC5qc1wiXScpLnJlbW92ZSgpO1xuICAgIHdpbmRvdy5NYXRoSmF4ID0gdW5kZWZpbmVkO1xuXG4gICAgLy8gUmVzZXQgYXR0YWNoIGZvciBhbnkgc3Vic2VxdWVudCBjYWxsc1xuICAgIHJldHVybiB0aGlzLmF0dGFjaE1hdGhKYXggPSBfLm9uY2UoKCkgPT4gYXR0YWNoTWF0aEpheCgpKTtcbiAgfSxcblxuICAvL1xuICAvLyBQcm9jZXNzIERPTSBlbGVtZW50cyBmb3IgTGFUZVggZXF1YXRpb25zIHdpdGggTWF0aEpheFxuICAvL1xuICAvLyBAcGFyYW0gZG9tRWxlbWVudHMgQW4gYXJyYXkgb2YgRE9NIGVsZW1lbnRzIHRvIGJlIHByb2Nlc3NlZCBieSBNYXRoSmF4LiBTZWVcbiAgLy8gICBbZWxlbWVudF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL2VsZW1lbnQpIGZvclxuICAvLyAgIGRldGFpbHMgb24gRE9NIGVsZW1lbnRzLlxuICAvL1xuICBtYXRoUHJvY2Vzc29yKGRvbUVsZW1lbnRzKSB7XG4gICAgaWYgKHR5cGVvZiBNYXRoSmF4ICE9PSAndW5kZWZpbmVkJyAmJiBNYXRoSmF4ICE9PSBudWxsKSB7XG4gICAgTWF0aEpheC5IdWIuUXVldWUoW1wiVHlwZXNldFwiLCBNYXRoSmF4Lkh1YiwgZG9tRWxlbWVudHNdKTtcbiAgICB9IGVsc2UgeyB0aGlzLmxvYWRNYXRoSmF4KCgpID0+IE1hdGhKYXguSHViLlF1ZXVlKFtcIlR5cGVzZXRcIiwgTWF0aEpheC5IdWIsIGRvbUVsZW1lbnRzXSkpOyB9XG4gIH0sXG5cbiAgLy9cbiAgLy8gUHJvY2VzcyBtYXRocyBpbiBIVE1MIGZyYWdtZW50IHdpdGggTWF0aEpheFxuICAvL1xuICAvLyBAcGFyYW0gaHRtbCBBIEhUTUwgZnJhZ21lbnQgc3RyaW5nXG4gIC8vIEBwYXJhbSBjYWxsYmFjayBBIGNhbGxiYWNrIG1ldGhvZCB0aGF0IGFjY2VwdHMgYSBzaW5nbGUgcGFyYW1ldGVyLCBhIEhUTUxcbiAgLy8gICBmcmFnbWVudCBzdHJpbmcgdGhhdCBpcyB0aGUgcmVzdWx0IG9mIGh0bWwgcHJvY2Vzc2VkIGJ5IE1hdGhKYXhcbiAgLy9cbiAgcHJvY2Vzc0hUTUxTdHJpbmcoaHRtbCwgY2FsbGJhY2spIHtcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZWxlbWVudC5pbm5lckhUTUwgPSBodG1sO1xuXG4gICAgY29uc3QgY29tcGlsZVByb2Nlc3NlZEhUTUxTdHJpbmcgPSBmdW5jdGlvbigpIHtcbiAgICAgIGNvbnN0IHN2Z0dseXBocyA9IF9fZ3VhcmRfXyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnTWF0aEpheF9TVkdfSGlkZGVuJyksIHggPT4geC5wYXJlbnROb2RlLmNsb25lTm9kZSh0cnVlKSk7XG4gICAgICBpZiAoc3ZnR2x5cGhzICE9IG51bGwpIHsgZWxlbWVudC5pbnNlcnRCZWZvcmUoc3ZnR2x5cGhzLCBlbGVtZW50LmZpcnN0Q2hpbGQpOyB9XG4gICAgICByZXR1cm4gZWxlbWVudC5pbm5lckhUTUw7XG4gICAgfTtcblxuICAgIGNvbnN0IHF1ZXVlUHJvY2Vzc0hUTUxTdHJpbmcgPSAoKSA9PlxuICAgICAgTWF0aEpheC5IdWIuUXVldWUoXG4gICAgICAgIFtcInNldFJlbmRlcmVyXCIsIE1hdGhKYXguSHViLCBcIlNWR1wiXSxcbiAgICAgICAgW1wiVHlwZXNldFwiLCBNYXRoSmF4Lkh1YiwgZWxlbWVudF0sXG4gICAgICAgIFtcInNldFJlbmRlcmVyXCIsIE1hdGhKYXguSHViLCBcIkhUTUwtQ1NTXCJdLFxuICAgICAgICBbICgpID0+IGNhbGxiYWNrKGNvbXBpbGVQcm9jZXNzZWRIVE1MU3RyaW5nKCkpXVxuICAgICAgKVxuICAgIDtcblxuICAgIGlmICh0eXBlb2YgTWF0aEpheCAhPT0gJ3VuZGVmaW5lZCcgJiYgTWF0aEpheCAhPT0gbnVsbCkge1xuICAgIHF1ZXVlUHJvY2Vzc0hUTUxTdHJpbmcoKTtcbiAgICB9IGVsc2UgeyB0aGlzLmxvYWRNYXRoSmF4KHF1ZXVlUHJvY2Vzc0hUTUxTdHJpbmcpOyB9XG5cbiAgfVxufTtcblxuLy9cbi8vIERlZmluZSBzb21lIGZ1bmN0aW9ucyB0byBoZWxwIGdldCBhIGhvbGQgb2YgdGhlIHVzZXIncyBMYXRleFxuLy8gTWFjcm9zLlxuLy9cbmNvbnN0IG5hbWVQYXR0ZXJuID0gbmV3IFJlZ0V4cChgXFxcbl5bXmEtekEtWlxcXFxkXFxcXHNdJFxcXG58XFxcbl5bYS16QS1aXSokXFxcbmApOyAgICAgICAgICAgICAvLyBsZXR0ZXJzLCBidXQgbm8gbnVtZXJhbHMuXG5cbmNvbnN0IGdldFVzZXJNYWNyb3NQYXRoID0gZnVuY3Rpb24oKSB7XG4gIGNvbnN0IHVzZXJNYWNyb3NQYXRoID0gIENTT04ucmVzb2x2ZShwYXRoLmpvaW4oYXRvbS5nZXRDb25maWdEaXJQYXRoKCksICdtYXJrZG93bi1wcmV2aWV3LXBsdXMnKSk7XG4gIHJldHVybiB1c2VyTWFjcm9zUGF0aCAhPSBudWxsID8gdXNlck1hY3Jvc1BhdGggOiBwYXRoLmpvaW4oYXRvbS5nZXRDb25maWdEaXJQYXRoKCksICdtYXJrZG93bi1wcmV2aWV3LXBsdXMuY3NvbicpO1xufTtcblxuY29uc3QgbG9hZE1hY3Jvc0ZpbGUgPSBmdW5jdGlvbihmaWxlUGF0aCkge1xuICBpZiAoIUNTT04uaXNPYmplY3RQYXRoKGZpbGVQYXRoKSkgeyByZXR1cm4ge307IH1cbiAgcmV0dXJuIENTT04ucmVhZEZpbGVTeW5jKGZpbGVQYXRoLCBmdW5jdGlvbihlcnJvciwgb2JqZWN0KSB7XG4gICAgaWYgKG9iamVjdCA9PSBudWxsKSB7IG9iamVjdCA9IHt9OyB9XG4gICAgaWYgKGVycm9yICE9IG51bGwpIHtcbiAgICAgIGNvbnNvbGUud2FybihgRXJyb3IgcmVhZGluZyBMYXRleCBNYWNyb3MgZmlsZSAnJHtmaWxlUGF0aH0nOiAke2Vycm9yLnN0YWNrICE9IG51bGwgPyBlcnJvci5zdGFjayA6IGVycm9yfWApO1xuICAgICAgaWYgKGF0b20ubm90aWZpY2F0aW9ucyAhPSBudWxsKSB7XG4gICAgICAgIGF0b20ubm90aWZpY2F0aW9ucy5hZGRFcnJvcihgRmFpbGVkIHRvIGxvYWQgTGF0ZXggTWFjcm9zIGZyb20gJyR7ZmlsZVBhdGh9J2AsIHtkZXRhaWw6IGVycm9yLm1lc3NhZ2UsIGRpc21pc3NhYmxlOiB0cnVlfSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvYmplY3Q7XG4gIH0pO1xufTtcblxuY29uc3QgbG9hZFVzZXJNYWNyb3MgPSBmdW5jdGlvbigpIHtcbiAgbGV0IHJlc3VsdDtcbiAgY29uc3QgdXNlck1hY3Jvc1BhdGggPSBnZXRVc2VyTWFjcm9zUGF0aCgpO1xuICBpZiAoZnMuaXNGaWxlU3luYyh1c2VyTWFjcm9zUGF0aCkpIHtcbiAgICByZXR1cm4gcmVzdWx0ID0gbG9hZE1hY3Jvc0ZpbGUodXNlck1hY3Jvc1BhdGgpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUubG9nKFwiQ3JlYXRpbmcgbWFya2Rvd24tcHJldmlldy1wbHVzLmNzb24sIHRoaXMgaXMgYSBvbmUtdGltZSBvcGVyYXRpb24uXCIpO1xuICAgIGNyZWF0ZU1hY3Jvc1RlbXBsYXRlKHVzZXJNYWNyb3NQYXRoKTtcbiAgICByZXR1cm4gcmVzdWx0ID0gbG9hZE1hY3Jvc0ZpbGUodXNlck1hY3Jvc1BhdGgpO1xuICB9XG59O1xuXG52YXIgY3JlYXRlTWFjcm9zVGVtcGxhdGUgPSBmdW5jdGlvbihmaWxlUGF0aCkge1xuICBjb25zdCB0ZW1wbGF0ZVBhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4uL2Fzc2V0cy9tYWNyb3MtdGVtcGxhdGUuY3NvblwiKTtcbiAgY29uc3QgdGVtcGxhdGVGaWxlID0gZnMucmVhZEZpbGVTeW5jKHRlbXBsYXRlUGF0aCwgJ3V0ZjgnKTtcbiAgcmV0dXJuIGZzLndyaXRlRmlsZVN5bmMoZmlsZVBhdGgsIHRlbXBsYXRlRmlsZSk7XG59O1xuXG5jb25zdCBjaGVja01hY3JvcyA9IGZ1bmN0aW9uKG1hY3Jvc09iamVjdCkge1xuICBmb3IgKGxldCBuYW1lIGluIG1hY3Jvc09iamVjdCkge1xuICAgIGNvbnN0IHZhbHVlID0gbWFjcm9zT2JqZWN0W25hbWVdO1xuICAgIGlmICghbmFtZS5tYXRjaChuYW1lUGF0dGVybikgfHwgIXZhbHVlTWF0Y2hlc1BhdHRlcm4odmFsdWUpKSB7XG4gICAgICBkZWxldGUgbWFjcm9zT2JqZWN0W25hbWVdO1xuICAgICAgaWYgKGF0b20ubm90aWZpY2F0aW9ucyAhPSBudWxsKSB7XG4gICAgICAgIGF0b20ubm90aWZpY2F0aW9ucy5hZGRFcnJvcihgRmFpbGVkIHRvIGxvYWQgTGFUZVggbWFjcm8gbmFtZWQgJyR7bmFtZX0nLiBQbGVhc2Ugc2VlIHRoZSBbTGFUZVggZ3VpZGVdKGh0dHBzOi8vZ2l0aHViLmNvbS9HYWxhZGlyaXRoL21hcmtkb3duLXByZXZpZXctcGx1cy9ibG9iL21hc3Rlci9MQVRFWC5tZCNtYWNyby1uYW1lcylgLCB7ZGlzbWlzc2FibGU6IHRydWV9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIG1hY3Jvc09iamVjdDtcbn07XG5cbnZhciB2YWx1ZU1hdGNoZXNQYXR0ZXJuID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgLy8gRGlmZmVyZW50IGNoZWNrIGJhc2VkIG9uIHdoZXRoZXIgdmFsdWUgaXMgc3RyaW5nIG9yIGFycmF5XG4gIHN3aXRjaCAoZmFsc2UpIHtcbiAgICAvLyBJZiBpdCBpcyBhbiBhcnJheSB0aGVuIGl0IHNob3VsZCBiZSBbc3RyaW5nLCBpbnRlZ2VyXVxuICAgIGNhc2UgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKSAhPT0gJ1tvYmplY3QgQXJyYXldJzpcbiAgICAgIHZhciBtYWNyb0RlZmluaXRpb24gPSB2YWx1ZVswXTtcbiAgICAgIHZhciBudW1iZXJPZkFyZ3MgPSB2YWx1ZVsxXTtcbiAgICAgIGlmICh0eXBlb2YgbnVtYmVyT2ZBcmdzICA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgcmV0dXJuICgobnVtYmVyT2ZBcmdzICUgMSkgPT09IDApICYmICh0eXBlb2YgbWFjcm9EZWZpbml0aW9uID09PSAnc3RyaW5nJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgLy8gSWYgaXQgaXMganVzdCBhIHN0cmluZyB0aGVuIHRoYXQncyBPSywgYW55IHN0cmluZyBpcyBhY2NlcHRhYmxlXG4gICAgY2FzZSB0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnOlxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgZGVmYXVsdDogcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuXG4vLyBDb25maWd1cmUgTWF0aEpheCBlbnZpcm9ubWVudC4gU2ltaWxhciB0byB0aGUgVGVYLUFNU19IVE1MIGNvbmZpZ3VyYXRpb24gd2l0aFxuLy8gYSBmZXcgdW5uZWNlc3NhcnkgZmVhdHVyZXMgc3RyaXBwZWQgYXdheVxuLy9cbmNvbnN0IGNvbmZpZ3VyZU1hdGhKYXggPSBmdW5jdGlvbigpIHtcbiAgbGV0IHVzZXJNYWNyb3MgPSBsb2FkVXNlck1hY3JvcygpO1xuICBpZiAodXNlck1hY3Jvcykge1xuICAgIHVzZXJNYWNyb3MgPSBjaGVja01hY3Jvcyh1c2VyTWFjcm9zKTtcbiAgfSBlbHNlIHtcbiAgICB1c2VyTWFjcm9zID0ge307XG4gIH1cblxuICAvL05vdyBDb25maWd1cmUgTWF0aEpheFxuICBNYXRoSmF4Lkh1Yi5Db25maWcoe1xuICAgIGpheDogW1xuICAgICAgXCJpbnB1dC9UZVhcIixcbiAgICAgIFwib3V0cHV0L0hUTUwtQ1NTXCJcbiAgICBdLFxuICAgIGV4dGVuc2lvbnM6IFtdLFxuICAgIFRlWDoge1xuICAgICAgZXh0ZW5zaW9uczogW1xuICAgICAgICBcIkFNU21hdGguanNcIixcbiAgICAgICAgXCJBTVNzeW1ib2xzLmpzXCIsXG4gICAgICAgIFwibm9FcnJvcnMuanNcIixcbiAgICAgICAgXCJub1VuZGVmaW5lZC5qc1wiXG4gICAgICBdLFxuICAgICAgTWFjcm9zOiB1c2VyTWFjcm9zXG4gICAgfSxcbiAgICBcIkhUTUwtQ1NTXCI6IHtcbiAgICAgIGF2YWlsYWJsZUZvbnRzOiBbXSxcbiAgICAgIHdlYkZvbnQ6IFwiVGVYXCJcbiAgICB9LFxuICAgIG1lc3NhZ2VTdHlsZTogXCJub25lXCIsXG4gICAgc2hvd01hdGhNZW51OiBmYWxzZSxcbiAgICBza2lwU3RhcnR1cFR5cGVzZXQ6IHRydWVcbiAgfSk7XG4gIE1hdGhKYXguSHViLkNvbmZpZ3VyZWQoKTtcblxuICAvLyBOb3RpZnkgdXNlciBNYXRoSmF4IGhhcyBsb2FkZWRcbiAgaWYgKGF0b20uaW5EZXZNb2RlKCkpIHsgYXRvbS5ub3RpZmljYXRpb25zLmFkZFN1Y2Nlc3MoXCJMb2FkZWQgbWF0aHMgcmVuZGVyaW5nIGVuZ2luZSBNYXRoSmF4XCIpOyB9XG5cbn07XG5cbi8vXG4vLyBBdHRhY2ggbWFpbiBNYXRoSmF4IHNjcmlwdCB0byB0aGUgZG9jdW1lbnRcbi8vXG52YXIgYXR0YWNoTWF0aEpheCA9IGZ1bmN0aW9uKCkge1xuICAvLyBOb3RpZnkgdXNlciBNYXRoSmF4IGlzIGxvYWRpbmdcbiAgaWYgKGF0b20uaW5EZXZNb2RlKCkpIHsgYXRvbS5ub3RpZmljYXRpb25zLmFkZEluZm8oXCJMb2FkaW5nIG1hdGhzIHJlbmRlcmluZyBlbmdpbmUgTWF0aEpheFwiKTsgfVxuXG4gIC8vIEF0dGFjaCBNYXRoSmF4IHNjcmlwdFxuICBjb25zdCBzY3JpcHQgICAgICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIik7XG4gIHNjcmlwdC5zcmMgID0gYCR7cmVxdWlyZS5yZXNvbHZlKCdNYXRoSmF4Jyl9P2RlbGF5U3RhcnR1cFVudGlsPWNvbmZpZ3VyZWRgO1xuICBzY3JpcHQudHlwZSA9IFwidGV4dC9qYXZhc2NyaXB0XCI7XG4gIHNjcmlwdC5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoKSA9PiBjb25maWd1cmVNYXRoSmF4KCkpO1xuICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF0uYXBwZW5kQ2hpbGQoc2NyaXB0KTtcblxuICByZXR1cm4gc2NyaXB0O1xufTtcblxuZnVuY3Rpb24gX19ndWFyZF9fKHZhbHVlLCB0cmFuc2Zvcm0pIHtcbiAgcmV0dXJuICh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnICYmIHZhbHVlICE9PSBudWxsKSA/IHRyYW5zZm9ybSh2YWx1ZSkgOiB1bmRlZmluZWQ7XG59XG4iXX0=